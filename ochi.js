!function(t){"use strict";function e(t,e){function i(){}i.prototype=t;var n=new i;for(var s in e)n[s]=e[s];return e.toString!==Object.prototype.toString&&(n.toString=e.toString),n}function i(t,e){if(null==e)return null;null==e.__id__&&(e.__id__=k++);var i;return null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=t,i.method=e,t.hx__closures__[e.__id__]=i),i}var n=function(){return p.__string_rec(this,"")},s=function(t,e,i){this.time=t,this.every=e,this.onEnd=i,this.count=0};s.__name__=!0,s.prototype={update:function(){this.count<this.time?(null!=this.every&&this.every(this,this.count),this.count++):this.end=!0,this.end&&null!=this.onEnd&&(this.onEnd(),this.onEnd=null)},__class__:s};var a=function(t){this.canvas=t,this.input=new B,this.__imageLoader=new C,this.__imageMap=new f,this.__setup()};a.__name__=!0,a.prototype={__setup:function(){var t=this,e=this,i=0,n=-1,s=window.devicePixelRatio,a=function(){return e.canvas.getBoundingClientRect().left},h=function(){return e.canvas.getBoundingClientRect().top};this.canvas.addEventListener("touchstart",function(t){t.preventDefault(),-1==n&&(n=t.changedTouches[0].identifier);for(var o=0,r=t.changedTouches.length;r>o;){var u=t.changedTouches[o++];if(u.identifier==n){var c=u.clientX-a();e.input._ntouchX=c*s;var _=u.clientY-h();e.input._ntouchY=_*s,e.input._ntouch=!0}}i+=t.changedTouches.length}),this.canvas.addEventListener("touchmove",function(t){t.preventDefault();for(var i=0,o=t.touches.length;o>i;){var r=t.touches[i++];if(r.identifier==n){var u=r.clientX-a();e.input._ntouchX=u*s;var c=r.clientY-h();e.input._ntouchY=c*s}}});var o=function(t){t.preventDefault();for(var o=0,r=t.changedTouches.length;r>o;){var u=t.changedTouches[o++];if(u.identifier==n){n=-1;var c=u.clientX-a();e.input._ntouchX=c*s;var _=u.clientY-h();e.input._ntouchY=_*s,e.input._ntouch=!1}}i-=t.changedTouches.length};if(this.canvas.addEventListener("touchend",o),this.canvas.addEventListener("touchcancel",o),this.canvas.addEventListener("mousedown",function(t){switch(t.preventDefault(),t.button){case 0:e.input._nmouseL=!0;break;case 2:e.input._nmouseR=!0}var i=t.clientX-a();e.input._nmouseX=i*s;var n=t.clientY-h();e.input._nmouseY=n*s}),this.canvas.addEventListener("mouseup",function(t){switch(t.preventDefault(),t.button){case 0:e.input._nmouseL=!1;break;case 2:e.input._nmouseR=!1}var i=t.clientX-a();e.input._nmouseX=i*s;var n=t.clientY-h();e.input._nmouseY=n*s}),this.canvas.addEventListener("mousemove",function(t){t.preventDefault();var i=t.clientX-a();e.input._nmouseX=i*s;var n=t.clientY-h();e.input._nmouseY=n*s}),this.canvas.oncontextmenu=function(){return!1},this.__state=0,this.setup(),1!=this.__state)throw new m("call init()");this.__state=2,this.__imageLoader.waitForAll(function(){t.onLoad();var e=t.__timer;e.running=!0,e.expectedNextTime=(new Date).getTime(),e.loop()})},setup:function(){throw new m("override this")},__loop:function(){this.input._update(),this.loop()},loop:function(){throw new m("override this")},onLoad:function(){},__class__:a};var h=function(t){a.call(this,t),h.o=this};h.__name__=!0,h.main=function(){new h(window.document.getElementById("canvas"))},h.__super__=a,h.prototype=e(a.prototype,{setup:function(){var t=window.navigator.userAgent;if(-1!=t.indexOf("iPad")||-1==t.indexOf("iPhone")&&-1==t.indexOf("Android")){if(0!=this.__state)throw new m("invalid call");switch(this.__state=1,this.__width=384,this.__height=576,this.canvas.width=384,this.canvas.height=576,y.Canvas2D[1]){case 0:this.gl=w.getContextWebGL(this.canvas,null);break;case 1:this.c2d=this.canvas.getContext("2d",null)}this.__timer=new j(60,i(this,this.__loop))}else{if(0!=this.__state)throw new m("invalid call");this.__state=1;var e=window.document.createElement("meta");e.setAttribute("name","viewport"),e.setAttribute("content","width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"),window.document.head.appendChild(e),window.document.body.style.margin="0";var n=window.devicePixelRatio,s=window.innerWidth,a=window.innerHeight;this.__width=s*n|0,this.__height=a*n|0,this.canvas.style.width=s+"px",this.canvas.style.height=a+"px",this.canvas.width=this.__width,this.canvas.height=this.__height;for(var h=this.canvas.parentElement;null!=h;)h.style.overflow="hidden",h=h.parentElement;switch(y.Canvas2D[1]){case 0:this.gl=w.getContextWebGL(this.canvas,null);break;case 1:this.c2d=this.canvas.getContext("2d",null)}this.__timer=new j(60,i(this,this.__loop))}this.loadImages(),this.screen=new Y(64,96),this.gCanvas=new L(this.c2d),this.g=new L(this.screen.c2d),this.initViewport(),this.initGame()},initGame:function(){var t=this;this.w=l.decode,this.sandW=64,this.sandH=96,this.randSeed=100,this.cocoaRatio=0,this.sugarLeft=!0,this.drawObjects=!1,this.flowing=!1,this.unkoMode?(this.cocoaChangeCount=2,this.unkoMode=!1):this.cocoaChangeCount=-600,this.actions=[],this.actions.push(new s(1e6,function(e){t.g.image(t.stgImg,64,0,64,96,0,0,64,96),t.g.image(t.titleImg,0,0,56,27,4,12,56,27),(1==t.input.dtouch||1==t.input.dmouseL)&&(e.end=!0)},function(){t.actions.push(new s(120,function(){t.drawObjects=0==(1&(t.count/3|0))},function(){t.drawObjects=!0,t.pl.randomMove(300,600,-1),t.actions.push(new s(120,null,function(){t.sugarChangeCount=-60,t.flowing=!0}))}))})),this.cocoaStack=0,this.sugarStack=0,this.count=0,this.pl=new r;var e=this.g,i=e.g2d.fillStyle;e.g2d.fillStyle="rgb(0,0,0)",e.g2d.fillRect(0,0,e.g2d.canvas.width,e.g2d.canvas.height),e.g2d.fillStyle=i},initViewport:function(){var t=this.screen.width,e=this.screen.height,i=1,n=0,s=0;t/e>this.__width/this.__height?(i=this.__width/t,s=0):(i=this.__height/e,n=(this.__width-t*i)/2),this.vp=new c(t,e,n,s,t*i,e*i)},loadImages:function(){if(0!=this.__state&&1!=this.__state)throw new m("invalid call");var t=new Image;if(t.src="pl.gif",this.__imageMap.set("pl.gif",t),this.__imageLoader.add(t),0!=this.__state&&1!=this.__state)throw new m("invalid call");var e=new Image;if(e.src="out.gif",this.__imageMap.set("out.gif",e),this.__imageLoader.add(e),0!=this.__state&&1!=this.__state)throw new m("invalid call");var i=new Image;if(i.src="stg.gif",this.__imageMap.set("stg.gif",i),this.__imageLoader.add(i),0!=this.__state&&1!=this.__state)throw new m("invalid call");var n=new Image;if(n.src="btn.gif",this.__imageMap.set("btn.gif",n),this.__imageLoader.add(n),0!=this.__state&&1!=this.__state)throw new m("invalid call");var s=new Image;if(s.src="end.gif",this.__imageMap.set("end.gif",s),this.__imageLoader.add(s),0!=this.__state&&1!=this.__state)throw new m("invalid call");var a=new Image;a.src="title.gif",this.__imageMap.set("title.gif",a),this.__imageLoader.add(a)},onLoad:function(){var t=this.__imageMap.get("pl.gif"),e=t.width,i=t.height,n=new Y(e,i);n.c2d.drawImage(t,0,0,e,i,0,0,e,i),this.playerImg=n;var s=this.__imageMap.get("out.gif"),a=s.width,h=s.height,o=new Y(a,h);o.c2d.drawImage(s,0,0,a,h,0,0,a,h),this.outImg=o;var r=this.__imageMap.get("stg.gif"),u=r.width,c=r.height,_=new Y(u,c);_.c2d.drawImage(r,0,0,u,c,0,0,u,c),this.stgImg=_;var g=this.__imageMap.get("btn.gif"),l=g.width,d=g.height,f=new Y(l,d);f.c2d.drawImage(g,0,0,l,d,0,0,l,d),this.btnImg=f;var v=this.__imageMap.get("end.gif"),m=v.width,p=v.height,w=new Y(m,p);w.c2d.drawImage(v,0,0,m,p,0,0,m,p),this.endImg=w;var b=this.__imageMap.get("title.gif"),O=b.width,S=b.height,y=new Y(O,S);y.c2d.drawImage(b,0,0,O,S,0,0,O,S),this.titleImg=y},loop:function(){if(this.update(),this.cocoaChangeCount>0&&0==(this.cocoaChangeCount>>1&1)){var t=this.gCanvas,e=t.g2d.fillStyle;t.g2d.fillStyle="rgb(255,255,255)",t.g2d.fillRect(0,0,t.g2d.canvas.width,t.g2d.canvas.height),t.g2d.fillStyle=e}else{var i=this.gCanvas,n=i.g2d.fillStyle;i.g2d.fillStyle="rgb(51,51,51)",i.g2d.fillRect(0,0,i.g2d.canvas.width,i.g2d.canvas.height),i.g2d.fillStyle=n,this.gCanvas.image(this.screen,0,0,this.screen.width,this.screen.height,this.vp.fromX(0),this.vp.fromY(0),this.vp.fromDX(this.screen.width),this.vp.fromDY(this.screen.height))}},update:function(){this.count++,this.clearPlayer();for(var t=0,e=this.actions;t<e.length;){var i=e[t];++t,i.update()}this.actions=this.actions.filter(function(t){return!t.end}),this.pl.update(),this.drawObjects&&this.drawPlayer(),this.drawSand(),this.screen.getPixels(),this.updateSand(),this.screen.setPixels()},drawSand:function(){if(this.drawStage(),this.drawOut(),this.flowing){if(this.g.strokeEnabled=!1,this.count%5==0&&(this.unkoMode?(this.putUnko(59,0),this.putUnko(60,0)):(this.sugarStack>0&&(this.sugarStack-=2,this.putSugar(59,0)),this.cocoaStack>0&&(this.cocoaStack-=2,this.putCocoa(60,0)))),this.input.mouseL){this.g.strokeEnabled=!1;var t=this.g;t.g2d.fillStyle="rgba(179,179,179,1)",t.fillEnabled=!0,this.drawLine(this.vp.toX(this.input.pmouseX),this.vp.toY(this.input.pmouseY),this.vp.toX(this.input.mouseX),this.vp.toY(this.input.mouseY))}if(this.input.touch){this.g.strokeEnabled=!1;var e=this.g;e.g2d.fillStyle="rgba(179,179,179,1)",e.fillEnabled=!0,this.drawLine(this.vp.toX(this.input.ptouchX),this.vp.toY(this.input.ptouchY),this.vp.toX(this.input.touchX),this.vp.toY(this.input.touchY))}}},drawLine:function(t,e,i,n){t=t-.5|0,e=e-.5|0,i=i-.5|0,n=n-.5|0;var s=i-t,a=n-e,h=s>0?s:-s,o=a>0?a:-a,r=0|(h>o?h:o);0==r&&(r=1);for(var u=0,c=r+1;c>u;){var _=u++/r,g=t+s*_,l=e+a*_;if(54>g&&64>l){var d=this.g,f=0|g,v=0|l;d.fillEnabled&&d.g2d.fillRect(f,v,2,2),d.strokeEnabled&&d.g2d.strokeRect(f,v,2,2)}}},drawStage:function(){this.drawObjects&&this.g.image(this.stgImg,0,0,64,96,0,0,64,96)},drawOut:function(){var t=this.sugarChangeCount>0&&0==(this.sugarChangeCount>>1&1),e=this.drawObjects?0:16;return this.unkoMode?(this.g.image(this.outImg,32,e,16,16,8,0,16,16),this.g.image(this.outImg,32,e,16,16,32,0,16,16),void(this.flowing&&(this.putUnko(15,11),this.putUnko(39,11)))):void(1==((this.sugarLeft?1:0)^(t?1:0))?(this.g.image(this.outImg,0,e,16,16,8,0,16,16),this.g.image(this.outImg,16,e,16,16,32,0,16,16),this.flowing&&(this.putSugar(15,11),this.putCocoa(39,11))):(this.g.image(this.outImg,16,e,16,16,8,0,16,16),this.g.image(this.outImg,0,e,16,16,32,0,16,16),this.flowing&&(this.putCocoa(15,11),this.putSugar(39,11))))},drawPlayer:function(){this.g.image(this.playerImg,this.pl.count%4*16,0,16,32,this.pl.x-8,this.screen.height-32,16,32)},clearPlayer:function(){this.screen.getPixels();for(var t=this.screen.width*this.screen.height,e=0;t>e;){var i=e++;-1==this.screen.pixels[i]&&(this.screen.pixels[i]=-16777216)}this.screen.setPixels()},updateSand:function(){var t=this.sandW-1,e=this.sandH-1,i=this.sandH-1,n=this.screen.pixels,s=0,a=0;if(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,0==(1&(this.randSeed^=this.randSeed<<5)))for(;i>=0;){for(var h=0;h<this.sandW;){var o=i<<6|h,r=n[o],u=i+1<<6|h,c=i<<6|h-1,_=i<<6|h+1,g=i+1<<6|h-1,l=i+1<<6|h+1,d=r>>16&255,f=r>>8&255,v=255&r;if(0!=d&&255!=d&&d==f&&f==v)--d,--f,--v,n[o]=-16777216|d<<16|f<<8|v;else{var m=255;if(!(d>192&&f>192&&v>192)||d==f&&f==v||255==d&&255==f&&255==v||(m=96,e>i&&-16777216==n[u]&&++s),d>=127.5&&153>=d&&f>=102&&114.75>=f&&v>=51&&63.75>=v){m=5;var p,w;if(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,w=(255&(this.randSeed^=this.randSeed<<5))>208?e>i:!1,p=w?-16777216!=n[u]:!1)n[u]=r;else{var b,O;if(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,O=(255&(this.randSeed^=this.randSeed<<5))>208?h>0:!1,b=O?-16777216!=n[c]:!1)n[c]=r;else{var S,y;this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,y=(255&(this.randSeed^=this.randSeed<<5))>208?t>h:!1,S=y?-16777216!=n[_]:!1,S&&(n[_]=r)}}}d>=153&&178.5>=d&&f>=76.5&&89.25>=f&&v>=51&&63.75>=v&&(m=96,e>i&&-16777216==n[u]&&++a),-16777216!=r&&(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,(255&(this.randSeed^=this.randSeed<<5))>m&&(i==e&&(n[o]=-16777216),e>i&&-1==n[u]?(n[o]=-16777216,80>i&&this.flowing&&(!(d>192&&f>192&&v>192)||d==f&&f==v||255==d&&255==f&&255==v?this.cocoaStack++:this.sugarStack++)):e>i&&-16777216==n[u]?(n[u]=r,n[o]=-16777216):h>0&&-16777216==n[c]&&-16777216==n[g]?(n[g]=r,n[o]=-16777216):t>h&&-16777216==n[_]&&-16777216==n[l]?(n[l]=r,n[o]=-16777216):t>h&&-16777216==n[_]&&(n[_]=r,n[o]=-16777216)))}++h}--i}else for(;i>=0;){for(var C=t;C>=0;){var B=i<<6|C,j=n[B],L=i+1<<6|C,Y=i<<6|C-1,k=i<<6|C+1,E=i+1<<6|C-1,x=i+1<<6|C+1,X=j>>16&255,I=j>>8&255,M=255&j;if(0!=X&&255!=X&&X==I&&I==M)--X,--I,--M,n[B]=-16777216|X<<16|I<<8|M;else{var D=255;if(!(X>192&&I>192&&M>192)||X==I&&I==M||255==X&&255==I&&255==M||(D=96,e>i&&-16777216==n[L]&&++s),X>=127.5&&153>=X&&I>=102&&114.75>=I&&M>=51&&63.75>=M){D=5;var R,A;if(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,A=(255&(this.randSeed^=this.randSeed<<5))>208?e>i:!1,R=A?-16777216!=n[L]:!1)n[L]=j;else{var T,P;if(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,P=(255&(this.randSeed^=this.randSeed<<5))>208?C>0:!1,T=P?-16777216!=n[Y]:!1)n[Y]=j;else{var G,W;this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,W=(255&(this.randSeed^=this.randSeed<<5))>208?t>C:!1,G=W?-16777216!=n[k]:!1,G&&(n[k]=j)}}}X>=153&&178.5>=X&&I>=76.5&&89.25>=I&&M>=51&&63.75>=M&&(D=96,e>i&&-16777216==n[L]&&++a),-16777216!=j&&(this.randSeed=(this.randSeed^=this.randSeed<<13)^this.randSeed>>17,(255&(this.randSeed^=this.randSeed<<5))>D&&(i==e&&(n[B]=-16777216),e>i&&-1==n[L]?(n[B]=-16777216,80>i&&this.flowing&&(!(X>192&&I>192&&M>192)||X==I&&I==M||255==X&&255==I&&255==M?this.cocoaStack++:this.sugarStack++)):e>i&&-16777216==n[L]?(n[L]=j,n[B]=-16777216):t>C&&-16777216==n[k]&&-16777216==n[x]?(n[x]=j,n[B]=-16777216):C>0&&-16777216==n[Y]&&-16777216==n[E]?(n[E]=j,n[B]=-16777216):C>0&&-16777216==n[Y]&&(n[Y]=j,n[B]=-16777216)))}--C}--i}var J=0,K=0,N=0;for(i=e;i>=0;){for(var H=56;H<this.sandW;){var q=n[i<<6|H],F=q>>16&255,z=q>>8&255,U=255&q;-16777216==q&&++J,F>=153&&178.5>=F&&z>=76.5&&89.25>=z&&U>=51&&63.75>=U&&++N,!(F>192&&z>192&&U>192)||F==z&&z==U||255==F&&255==z&&255==U||++K,++H}--i}console.log(a),this.flowing&&(0==J&&(this.cocoaRatio=0==N?0:N/(N+K),this.gameEnd()),this.cocoaChangeCount<0?8>a&&0==++this.cocoaChangeCount&&(this.cocoaChangeCount=1):(this.cocoaChangeCount++,30==this.cocoaChangeCount&&(this.unkoMode=!0,this.pl.goMad(),this.cocoaChangeCount=-1e9)),this.unkoMode||(this.sugarChangeCount<0?this.sugarChangeCount++:(8>s&&0==this.sugarChangeCount&&(this.sugarLeft=!this.sugarLeft,this.sugarChangeCount=1),this.sugarChangeCount>0&&this.sugarChangeCount++>=60&&(this.sugarChangeCount=-60))))},gameEnd:function(){var t=this;this.flowing=!1,this.actions.push(new s(180,null,function(){t.actions.push(new s(1e8,function(e){var i=-1==t.input.dmouseL||-1==t.input.dtouch,n=t.input.mouseL||t.input.touch?1:-1;t.g.image(t.endImg,0,0,12,16,6,24+Math.sin(.1*t.count),12,16),t.g.image(t.endImg,0,16,12,16,22,24+Math.sin(.1*t.count+1),12,16),t.g.image(t.endImg,0,32,12,16,38,24+Math.sin(.1*t.count+2),12,16),t.mouseIn(10,48,12,12)?(t.g.image(t.btnImg,0,0,12,12,10,48+n,12,12),i&&t.tweet()):t.g.image(t.btnImg,0,0,12,12,10,48,12,12),t.mouseIn(34,48,12,12)?(t.g.image(t.btnImg,12,0,12,12,34,48+n,12,12),i&&(e.end=!0)):t.g.image(t.btnImg,12,0,12,12,34,48,12,12)},i(t,t.initGame)))}))},tweet:function(){var t=this.unkoMode?"あ…ありのまま、今起こった事を話すぜ！\n「おれは砂糖抜きココアを作ろうとしたら　別の何かが降り注いできた」\nココアの粉だとか砂糖だとか、そんなチャチなもんじゃあ断じてねえ\nもっと恐ろしいものの片鱗を味わったぜ… #happy_sugarless":this.resultText()+" #happy_sugarless "+window.location.href,e=encodeURIComponent(t);window.document.location.href="https://twitter.com/intent/tweet?text="+e},resultText:function(){var t=Math.round(100*this.cocoaRatio);return 0==t&&this.cocoaRatio>0?t=1:100==t&&this.cocoaRatio<1&&(t=99),0==t?this.v(0):10>=t?t+this.v(1):30>=t?this.v(2)+t+this.v(3):50>=t?this.v(2)+t+this.v(4):70>=t?this.v(2)+t+this.v(5):85>=t?this.v(2)+t+this.v(6):99>=t?this.v(2)+t+this.v(7):this.v(8)},v:function(t){return this.w(["57SU5bqmMTAwJeOBruegguezluOBjOOBp+OBjeOBvuOBl+OBn++8ge+8gSDjgarjgpPjgaDjgZ3jga7jgqrjg4E","JeOBoOOBkeOCs+OCs+OCouOBjOa3t+WFpeOBl+OBn+egguezluOCkuaJi+OBq+WFpeOCjOOBvuOBl+OBn++8gSDjgrPjgrPjgqLjganjgZPjgavjgYLjgorjgb7jgZnjgYvjga3vvJ8","57SU5bqm","JeOBrueUmOOBmeOBjuOBpumjsuOCgeOBquOBhOOCs+OCs+OCouOBrueyieOBjOOBp+OBjeOBvuOBl+OBn++8gSAo776J4oiAYCnvvoniiIBgKe++ieKIgGAp7728776e772q772v776E7729776E776Y772w776R772x776B772s772w","JeOBruegguezluOCkuWFpeOCjOmBjuOBjuOBn+OCs+OCs+OCouOBrueyieOBjOOBp+OBjeOBvuOBl+OBn++8gSAo776J4oiAYCnvvbHvvoHvvazvvbA","JeOBruOBiuOBhOOBl+OBneOBhuOBquOCs+OCs+OCouOBrueyieOBjOOBp+OBjeOBvuOBl+OBn+OAgiDjgJDmgKXli5/jgJHjgrPjg7zjg5Ljg7zjgafjgoLjgYrojLbjgafjgoLmsLTjgafjgoLjgarjgYTnlJjjgY/jgarjgYTpo7Lmlpk","JeOBruODk+OCv+ODvOOBquOCs+OCs+OCouOBjOOBp+OBjeOBvuOBl+OBn+OAgiDjgZXjgaPjgbHjgorjgZfjgabjgIHjgZ3jgozjgarjgorjgavjgIHjgYrjgYTjgZfjgYTjg70oPcK04pa9YD0p776J","JeOBruOBu+OBqOOCk+OBqeegguezluaKnOOBjeOCs+OCs+OCouOBjOOBp+OBjeOBvuOBl+OBn+OAgiDjgZ3jgoznvo7lkbPjgZfjgYTjga7jgYvigKbigKbvvJ8","56CC57OW5oqc44GN44Gu44Kz44Kz44Ki44Gu57KJ44KS5omL44Gr5YWl44KM44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB77yB"][t]).toString()},mouseIn:function(t,e,i,n){var s,a;return this.input.touch||0!=this.input.dtouch?(s=this.input.touchX,a=this.input.touchY):(s=this.input.mouseX,a=this.input.mouseY),s=this.vp.toX(s),a=this.vp.toY(a),s>=t&&t+i>s&&a>=e?e+n>a:!1},putSugar:function(t,e){this.g.strokeEnabled=!1;var i=this.g,n="rgba("+(255*(.9+.1*Math.random())+.5|0)+","+(255*(.93+.07*Math.random())+.5|0)+","+(255*(.95+.05*Math.random())+.5|0)+",1";i.g2d.fillStyle=n+")",i.fillEnabled=!0;var s=this.g;s.fillEnabled&&s.g2d.fillRect(t,e,1,1),s.strokeEnabled&&s.g2d.strokeRect(t,e,1,1)},putCocoa:function(t,e){this.g.strokeEnabled=!1;var i=this.g,n="rgba("+(255*(.6+.1*Math.random())+.5|0)+","+(255*(.3+.05*Math.random())+.5|0)+","+(255*(.2+.05*Math.random())+.5|0)+",1";i.g2d.fillStyle=n+")",i.fillEnabled=!0;var s=this.g;s.fillEnabled&&s.g2d.fillRect(t,e,1,1),s.strokeEnabled&&s.g2d.strokeRect(t,e,1,1)},putUnko:function(t,e){this.g.strokeEnabled=!1;var i=this.g,n="rgba("+(255*(.5+.1*Math.random())+.5|0)+","+(255*(.4+.05*Math.random())+.5|0)+","+(255*(.2+.05*Math.random())+.5|0)+",1";i.g2d.fillStyle=n+")",i.fillEnabled=!0;var s=this.g;s.fillEnabled&&s.g2d.fillRect(t,e,1,1),s.strokeEnabled&&s.g2d.strokeRect(t,e,1,1)},__class__:h});var o=function(){};o.__name__=!0,o.cca=function(t,e){var i=t.charCodeAt(e);return i!=i?void 0:i},o.substr=function(t,e,i){if(null==i)i=t.length;else if(0>i){if(0!=e)return"";i=t.length+i}return t.substr(e,i)},Math.__name__=!0;var r=function(){this.x=28,this.targetX=28,this.count=0,this.actions=[]};r.__name__=!0,r.prototype={update:function(){var t=Math.round(this.approach(this.x,this.targetX,1))-this.x;0!=t&&this.count++,this.x+=t;for(var e=0,i=this.actions;e<i.length;){var n=i[e];++e,n.update()}this.actions=this.actions.filter(function(t){return!t.end})},randomMove:function(t,e,i){var n=this,a=this.randInt(t,e),h=this.randInt(10,45),o=this.x;this.actions.push(new s(a,function(t,e){var i=e/a,s=i/1;s>1?s=1:0>s&&(s=0),i=s*s*(3-2*s),n.targetX=Math.round(o+(h-o)*i)},function(){(i>0||-1==i)&&n.randomMove(t,e,i>0?i-1:-1)}))},goMad:function(){var t=this;this.actions=[],this.actions.push(new s(1e8,function(e,i){t.targetX=0==(i>>5&1)?10:46},null))},randInt:function(t,e){return t+(Math.random()*(e-t+1)|0)},approach:function(t,e,i){return e-i>t?t+i:t>e+i?t-i:e},__class__:r};var u=function(){};u.__name__=!0,u.string=function(t){return p.__string_rec(t,"")};var c=function(t,e,i,n,s,a){this.targetW=t,this.targetH=e,this.tx=i,this.ty=n,this.sx=t/s,this.sy=e/a};c.__name__=!0,c.prototype={toX:function(t){return(t-this.tx)*this.sx},toY:function(t){return(t-this.ty)*this.sy},fromX:function(t){return t/this.sx+this.tx},fromY:function(t){return t/this.sy+this.ty},toDX:function(t){return t*this.sx},toDY:function(t){return t*this.sy},fromDX:function(t){return t/this.sx},fromDY:function(t){return t/this.sy},__class__:c};var _=function(){};_.__name__=!0,_.prototype={__class__:_};var g=function(t){this.length=t.byteLength,this.b=new T(t),this.b.bufferValue=t,t.hxBytes=this,t.bytes=this.b};g.__name__=!0,g.ofString=function(t){for(var e=[],i=0;i<t.length;){var n=t.charCodeAt(i++);n>=55296&&56319>=n&&(n=n-55232<<10|1023&t.charCodeAt(i++)),127>=n?e.push(n):2047>=n?(e.push(192|n>>6),e.push(128|63&n)):65535>=n?(e.push(224|n>>12),e.push(128|n>>6&63),e.push(128|63&n)):(e.push(240|n>>18),e.push(128|n>>12&63),e.push(128|n>>6&63),e.push(128|63&n))}return new g(new T(e).buffer)},g.prototype={getString:function(t,e){if(0>t||0>e||t+e>this.length)throw new m(v.OutsideBounds);for(var i="",n=this.b,s=String.fromCharCode,a=t,h=t+e;h>a;){var o=n[a++];if(128>o){if(0==o)break;i+=s(o)}else if(224>o)i+=s((63&o)<<6|127&n[a++]);else if(240>o)i+=s((31&o)<<12|(127&n[a++])<<6|127&n[a++]);else{var r=(15&o)<<18|(127&n[a++])<<12|(127&n[a++])<<6|127&n[a++];i+=s((r>>10)+55232),i+=s(1023&r|56320)}}return i},toString:function(){return this.getString(0,this.length)},__class__:g};var l=function(){};l.__name__=!0,l.decode=function(t,e){if(null==e&&(e=!0),e)for(;61==o.cca(t,t.length-1);)t=o.substr(t,0,-1);return new d(l.BYTES).decodeBytes(g.ofString(t))};var d=function(t){for(var e=t.length,i=1;e>1<<i;)++i;if(i>8||e!=1<<i)throw new m("BaseCode : base length must be a power of two.");this.base=t,this.nbits=i};d.__name__=!0,d.prototype={initTable:function(){for(var t=[],e=0;256>e;)t[e++]=-1;for(var i=0,n=this.base.length;n>i;){var s=i++;t[this.base.b[s]]=s}this.tbl=t},decodeBytes:function(t){var e=this.nbits;null==this.tbl&&this.initTable();for(var i=this.tbl,n=t.length*e>>3,s=new g(new A(n)),a=0,h=0,o=0,r=0;n>r;){for(;8>h;){h+=e,a<<=e;var u=i[t.b[o++]];if(-1==u)throw new m("BaseCode : invalid encoded char");a|=u}h-=8,s.b[r++]=a>>h&255&255}return s},__class__:d};var f=function(){this.h={}};f.__name__=!0,f.__interfaces__=[_],f.prototype={set:function(t,e){null!=R[t]?this.setReserved(t,e):this.h[t]=e},get:function(t){return null!=R[t]?this.getReserved(t):this.h[t]},setReserved:function(t,e){null==this.rh&&(this.rh={}),this.rh["$"+t]=e},getReserved:function(t){return null==this.rh?null:this.rh["$"+t]},__class__:f};var v={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};v.Blocked=["Blocked",0],v.Blocked.toString=n,v.Blocked.__enum__=v,v.Overflow=["Overflow",1],v.Overflow.toString=n,v.Overflow.__enum__=v,v.OutsideBounds=["OutsideBounds",2],v.OutsideBounds.toString=n,v.OutsideBounds.__enum__=v,v.Custom=function(t){var e=["Custom",3,t];return e.__enum__=v,e.toString=n,e};var m=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,m)};m.__name__=!0,m.wrap=function(t){return t instanceof Error?t:new m(t)},m.__super__=Error,m.prototype=e(Error.prototype,{__class__:m});var p=function(){};p.__name__=!0,p.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var e=t.__class__;if(null!=e)return e;var i=p.__nativeClassName(t);return null!=i?p.__resolveNativeClass(i):null},p.__string_rec=function(t,e){if(null==t)return"null";if(e.length>=5)return"<...>";var i=typeof t;switch("function"==i&&(t.__name__||t.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var n=t[0]+"(";e+="	";for(var s=2,a=t.length;a>s;){var h=s++;n+=2!=h?","+p.__string_rec(t[h],e):p.__string_rec(t[h],e)}return n+")"}var o=t.length,r="[";e+="	";for(var u=0,c=o;c>u;){var _=u++;r+=(_>0?",":"")+p.__string_rec(t[_],e)}return r+="]"}var g;try{g=t.toString}catch(l){return"???"}if(null!=g&&g!=Object.toString&&"function"==typeof g){var d=t.toString();if("[object Object]"!=d)return d}var f=null,v="{\n";e+="	";var m=null!=t.hasOwnProperty;for(var f in t)(!m||t.hasOwnProperty(f))&&"prototype"!=f&&"__class__"!=f&&"__super__"!=f&&"__interfaces__"!=f&&"__properties__"!=f&&(2!=v.length&&(v+=", \n"),v+=e+f+" : "+p.__string_rec(t[f],e));return e=e.substring(1),v+="\n"+e+"}";case"string":return t;default:return String(t)}},p.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var n=0,s=i.length;s>n;){var a=i[n++];if(a==e||p.__interfLoop(a,e))return!0}return p.__interfLoop(t.__super__,e)},p.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Array:return t instanceof Array?null==t.__enum__:!1;case I:return"boolean"==typeof t;case x:return!0;case X:return"number"==typeof t;case E:return"number"==typeof t?(0|t)===t:!1;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof e){if(t instanceof e)return!0;if(p.__interfLoop(p.getClass(t),e))return!0}else if("object"==typeof e&&p.__isNativeObj(e)&&t instanceof e)return!0;return(e==M?null==t.__name__:1)?(e==D?null==t.__ename__:1)?t.__enum__==e:!0:!0}},p.__nativeClassName=function(t){var e=p.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},p.__isNativeObj=function(t){return null!=p.__nativeClassName(t)},p.__resolveNativeClass=function(e){return t[e]};var w=function(){};w.__name__=!0,w.getContextWebGL=function(t,e){for(var i=0,n=["webgl","experimental-webgl"];i<n.length;){var s=n[i];++i;var a=t.getContext(s,e);if(null!=a)return a}return null};var b=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var e=t;this.a=[];for(var i=0,n=e;n>i;)this.a[i++]=0;this.byteLength=e}};b.__name__=!0,b.sliceImpl=function(t,e){var i=new T(this,t,null==e?null:e-t),n=new A(i.byteLength);return new T(n).set(i),n},b.prototype={slice:function(t,e){return new b(this.a.slice(t,e))},__class__:b};var O=function(){};O.__name__=!0,O._new=function(t,e,i){var n;if("number"==typeof t){n=[];for(var s=0,a=t;a>s;){var h=s++;n[h]=0}n.byteLength=n.length,n.byteOffset=0,n.buffer=new b(n)}else if(p.__instanceof(t,b)){var o=t;null==e&&(e=0),null==i&&(i=o.byteLength-e),n=0==e?o.a:o.a.slice(e,e+i),n.byteLength=n.length,n.byteOffset=e,n.buffer=o}else{if(!(t instanceof Array&&null==t.__enum__))throw new m("TODO "+u.string(t));n=t.slice(),n.byteLength=n.length,n.byteOffset=0,n.buffer=new b(n)}return n.subarray=O._subarray,n.set=O._set,n},O._set=function(t,e){if(p.__instanceof(t.buffer,b)){var i=t;if(t.byteLength+e>this.byteLength)throw new m("set() outside of range");for(var n=0,s=t.byteLength;s>n;){var a=n++;this[a+e]=i[a]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new m("TODO");var h=t;if(h.length+e>this.byteLength)throw new m("set() outside of range");for(var o=0,r=h.length;r>o;){var u=o++;this[u+e]=h[u]}}},O._subarray=function(t,e){var i=O._new(this.slice(t,e));return i.byteOffset=t,i};var S={__ename__:!0,__constructs__:["Blend","Add","Multiply","Screen"]};S.Blend=["Blend",0],S.Blend.toString=n,S.Blend.__enum__=S,S.Add=["Add",1],S.Add.toString=n,S.Add.__enum__=S,S.Multiply=["Multiply",2],S.Multiply.toString=n,S.Multiply.__enum__=S,S.Screen=["Screen",3],S.Screen.toString=n,S.Screen.__enum__=S;var y={__ename__:!0,__constructs__:["WebGL","Canvas2D"]};y.WebGL=["WebGL",0],y.WebGL.toString=n,y.WebGL.__enum__=y,y.Canvas2D=["Canvas2D",1],y.Canvas2D.toString=n,y.Canvas2D.__enum__=y;var C=function(){this.images=[]};C.__name__=!0,C.prototype={add:function(t){this.images.push(t)},waitForAll:function(t){var e=this.images.length;if(0==e)return void t();for(var i=0,n=this.images;i<n.length;){var s=n[i];++i,s.onload=function(){0==(e-=1)&&t()}}},__class__:C};var B=function(){this.ptouchX=0,this.ptouchY=0,this.touchX=0,this.touchY=0,this.dtouchX=0,this.dtouchY=0,this._ntouchX=0,this._ntouchY=0,this.ptouch=!1,this.touch=!1,this._ntouch=!1,this.dtouch=0,this.pmouseX=0,this.pmouseY=0,this.mouseX=0,this.mouseY=0,this.dmouseX=0,this.dmouseY=0,this._nmouseX=0,this._nmouseY=0,this.pmouseL=!1,this.pmouseR=!1,this.mouseL=!1,this.mouseR=!1,this.dmouseL=0,this.dmouseR=0,this._nmouseL=!1,this._nmouseR=!1};B.__name__=!0,B.prototype={_update:function(){this.ptouchX=this.touchX,this.ptouchY=this.touchY,this.touchX=this._ntouchX,this.touchY=this._ntouchY,this.dtouchX=this.touchX-this.ptouchX,this.dtouchY=this.touchY-this.ptouchY,this.ptouch=this.touch,this.touch=this._ntouch,this.dtouch=(this.touch?1:0)-(this.ptouch?1:0),1==this.dtouch&&(this.ptouchX=this.touchX,this.ptouchY=this.touchY),this.pmouseX=this.mouseX,this.pmouseY=this.mouseY,this.mouseX=this._nmouseX,this.mouseY=this._nmouseY,this.dmouseX=this.mouseX-this.pmouseX,this.dmouseY=this.mouseY-this.pmouseY,this.pmouseL=this.mouseL,this.pmouseR=this.mouseR,this.mouseL=this._nmouseL,this.mouseR=this._nmouseR,this.dmouseL=(this.mouseL?1:0)-(this.pmouseL?1:0),this.dmouseR=(this.mouseR?1:0)-(this.pmouseR?1:0)},__class__:B};var j=function(t,e){this.targetFPS=t,this.targetFunction=e,this.running=!1};j.__name__=!0,j.prototype={run:function(){this.running=!0,this.expectedNextTime=(new Date).getTime(),this.loop()},stop:function(){this.running=!1},loop:function(){this.targetFunction();var t=(new Date).getTime(),e=this.expectedNextTime+1e3/this.targetFPS-t;5>e&&(e=5),this.expectedNextTime=t+e,this.running&&window.setTimeout(i(this,this.loop),e+.5|0)},time:function(){return(new Date).getTime()},__class__:j};var L=function(t){this.g2d=t};L.__name__=!0,L.prototype={background:function(t,e,i){var n=this.g2d.fillStyle;this.g2d.fillStyle="rgb("+(255*t+.5|0)+","+(255*e+.5|0)+","+(255*i+.5|0)+")",this.g2d.fillRect(0,0,this.g2d.canvas.width,this.g2d.canvas.height),this.g2d.fillStyle=n},fill:function(t,e,i,n){null==n&&(n=1),this.g2d.fillStyle="rgba("+(255*t+.5|0)+","+(255*e+.5|0)+","+(255*i+.5|0)+","+n+")",this.fillEnabled=!0},noFill:function(){this.fillEnabled=!1},stroke:function(t,e,i,n){null==n&&(n=1),this.g2d.strokeStyle="rgba("+(255*t+.5|0)+","+(255*e+.5|0)+","+(255*i+.5|0)+","+n+")",this.strokeEnabled=!0},noStroke:function(){this.strokeEnabled=!1},strokeWeight:function(t){this.g2d.lineWidth=t},rect:function(t,e,i,n){this.fillEnabled&&this.g2d.fillRect(t,e,i,n),this.strokeEnabled&&this.g2d.strokeRect(t,e,i,n)},circle:function(t,e,i){this.g2d.beginPath(),this.g2d.arc(t,e,i,0,2*Math.PI,!1),this.fillEnabled&&this.g2d.fill(),this.strokeEnabled&&this.g2d.stroke()},line:function(t,e,i,n){this.g2d.beginPath(),this.g2d.moveTo(t,e),this.g2d.lineTo(i,n),this.g2d.stroke()},blendMode:function(t){switch(t[1]){case 0:this.g2d.globalCompositeOperation="source-over";break;case 1:this.g2d.globalCompositeOperation="lighter";break;case 2:this.g2d.globalCompositeOperation="multiply";break;case 3:this.g2d.globalCompositeOperation="screen"}},push:function(){this.g2d.save()},pop:function(){this.g2d.restore()},scale:function(t,e){this.g2d.scale(t,e)},translate:function(t,e){this.g2d.translate(t,e)},image:function(t,e,i,n,s,a,h,o,r){this.g2d.imageSmoothingEnabled=!1,this.g2d.msImageSmoothingEnabled=!1,this.g2d.drawImage(t.canvas,e,i,n,s,a,h,o,r)},imageSmooth:function(t,e,i,n,s,a,h,o,r){this.g2d.imageSmoothingEnabled=!0,this.g2d.msImageSmoothingEnabled=!0,this.g2d.drawImage(t.canvas,e,i,n,s,a,h,o,r)},__class__:L};var Y=function(t,e){this.width=t,this.height=e,this.pixels=new Array(t*e),this.canvas=window.document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.c2d=this.canvas.getContext("2d",null)};Y.__name__=!0,Y.prototype={getPixels:function(){this.imageData=this.c2d.getImageData(0,0,this.width,this.height);for(var t=this.width*this.height,e=0,i=0;t>i;)this.pixels[i++]=this.imageData.data[e+3]<<24|this.imageData.data[e]<<16|this.imageData.data[e+1]<<8|this.imageData.data[e+2],e+=4},setPixels:function(){for(var t=this.width*this.height,e=0,i=0;t>i;){var n=i++,s=this.pixels[n]>>>24,a=this.pixels[n]>>>8&255,h=255&this.pixels[n];this.imageData.data[e]=this.pixels[n]>>>16&255,this.imageData.data[e+1]=a,this.imageData.data[e+2]=h,this.imageData.data[e+3]=s,e+=4}this.c2d.putImageData(this.imageData,0,0)},__class__:Y};var k=0;String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0,Date.prototype.__class__=Date,Date.__name__=["Date"];var E={__name__:["Int"]},x={__name__:["Dynamic"]},X=Number;X.__name__=["Float"];var I=Boolean;I.__ename__=["Bool"];var M={__name__:["Class"]},D={},R={},A=t.ArrayBuffer||b;null==A.prototype.slice&&(A.prototype.slice=b.sliceImpl);var T=t.Uint8Array||O._new;h.BG=-16777216,h.WALL=-8355712,l.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l.BYTES=g.ofString(l.CHARS),p.__toStr={}.toString,O.BYTES_PER_ELEMENT=1,h.main()
}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
